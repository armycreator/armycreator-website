{% extends 'SitiowebArmyCreatorBundle::layout.html.twig' %}

{% block title %}
    {{ army.name }} - 
    {{ army.user.username }} -
    {{ army.breed.name }} -
    {{ army.breed.game.name }}
{% endblock %}

{% block h1Container %}
{% endblock %}

{% block content %}
<header>
    <aside class="action">
        <a href="javascript:window.print();" class="acButton" accesskey="p" title="{{ 'army.detail.print'|trans }}">
            <i class="icon-print"></i>
            {{ 'army.detail.print'|trans }}
        </a>
        <a href="{{ path('army_detail_pdf', { 'slug' : army.slug } ) }}" class="acButton" accesskey="f" title="{{ 'army.detail.pdf'|trans }}">
            <i class="icon-file"></i>
            {{ 'army.detail.pdf'|trans }}
        </a>
        <a href="{{ path('army_detail_bbcode', { 'slug' : army.slug } ) }}" class="acButton" accesskey="b" title="{{ 'army.detail.bb_code'|trans }}">
            <i class="icon-comment"></i>
            {{ 'army.detail.bb_code'|trans }}
        </a>
        <a href="#" class="acButton">
            <i class="icon-share"></i>
            {{ 'army.detail.share'|trans }}
        </a>
    </aside>

    <figure class="breed txtcenter">
        {{ breedImage(army.breed)|raw }}

        <figcaption>
            {{ army.breed.name }}
        </figcaption>
    </figure>

    <div class="armyDescription">
        <h1 class="name">
            {{ army.name }} | 
            {{ army.breed.name }}

            <a href="{{ path('army_edit', { 'slug' : army.slug }) }}" class="acButton acButtonSmall">
                <i class="icon-pencil"></i>
            </a>

            {% if deleteForm is defined %}
                <form
                    action="{{ path('army_delete', { 'slug': army.slug }) }}"
                    method="post"
                    class="inbl"
                    onsubmit="javascript:return confirm('{% trans %}army.detail.delete{% endtrans %}');"
                >
                    {{ form_widget(deleteForm) }}
                    <button type="submit" class="acButton acButtonSmall">
                        <i class="icon-remove"></i>
                    </button>
                </form>
            {% endif %}
        </h1>

        {% if army.wantedPoints > 0 %}
            <div class="pointBarContainer">
                <div class="pointBar">
                    <div style="width:{% if army.points > army.wantedPoints %}100{% else %}{{ 100 * army.points /  army.wantedPoints }}{% endif %}%"></div>
                </div>
                <strong>
                    {% trans with { "%pts%": army.points } %}army.detail.pts.%pts%{% endtrans %}
                </strong>
                / {% trans with { "%pts%": army.wantedPoints } %}army.detail.wanted_pts.%pts%{% endtrans %}
            </div>
        {% endif %}

        {% if army.description %}
            <div class="description">
                <span>Description :</span>
                {{ army.description }}
            </div>
        {% endif %}
    </div>
</header>

<section id="armyDetailContainer">
    {% block armyDetail %}
        <div id="armyDetail">
            {# ===== Unit Type length ===== #}
            <div class="unitTypeTopList">
                {% for tmp in army.squadListByType %}
                    <div>
                        <a href="#unitType{{ tmp.unitType.id }}">
                            {{ tmp.squadList|length }} {{ tmp.unitType.name }}
                            {% if tmp.unitType.breed != army.breed %}
                                ({{ tmp.unitType.breed.name }})
                            {% endif %}
                        </a>
                    </div>
                {% endfor %}
            </div>

            {# ===== Squad List ===== #}
            {% for tmp in army.squadListByType %}
                <section class="unitTypeList row gut" id="unitType{{ tmp.unitType.id }}">
                    <h3 class="unitType col">
                        <div class="unitTypeStick" style="background-color:{{ tmp.unitType.color|default("#ccc") }}"></div>
                        {{ tmp.unitType.name }}
                        {% if tmp.unitType.breed != army.breed %}
                            ({{ tmp.unitType.breed.name }})
                        {% endif %}
                        <div>
                           {% trans with { "%pts%":tmp.points } %}army.detail.pts.%pts%{% endtrans %}
                        </div>
                    </h3>
                    <div class="col squadListContainer">
                        <section class="squadList">
                            {% for squad in tmp.squadList %}
                                    <div class="squad">
                                        <div class="squadName">
                                            <h4>
                                                <div class="unitTypeStick" style="background-color:{{ tmp.unitType.color|default("#ccc") }}"></div>
                                                {{ squad.name|default(squad.unitType.name ~ ' #' ~ loop.index) }}
                                                <span>
                                                    {% trans with { "%pts%": squad.points } %}army.detail.pts.%pts%{% endtrans %}
                                                </span>
                                            </h4>
                                        </div>

                                        <div>
                                            {% for squadLine in squad.squadLineList %}
                                                <div class="squadLine">
                                                    <h5>{{ squadLine.number }} {{ squadLine.unit.name }}</h5>
                                                    {% if not(squadLine.squadLineStuffList.empty) %}
                                                        <ul>
                                                            {% for squadLineStuffList in squadLine.squadLineStuffList %}
                                                                <li>
                                                                    {{ squadLineStuffList.number }}
                                                                    {{ squadLineStuffList.unitStuff.stuff.name }}
                                                                </li>
                                                            {% endfor %}
                                                        </ul>
                                                    {% endif %}
                                                </div>
                                            {% endfor %}
                                        </div>

                                        <aside class="actions">
                                            <a href="javascript:;" class="acButton">
                                                <i class="icon-move"></i>
                                            </a>

                                            <div class="right">
                                                <a href="{{ path('squad_edit', {'armySlug' : army.slug, 'id' : squad.id}) }}" class="acButton">
                                                    <i class="icon-pencil"></i>
                                                </a>

                                                <form
                                                    action="{{ path('squad_delete', { 'armySlug': army.slug, 'id' : squad.id }) }}"
                                                    method="post"
                                                    class="inbl"
                                                    onsubmit="javascript:return confirm('{% trans %}army.detail.squad.delete{% endtrans %}');"
                                                >
                                                    {% set deleteSquadForm = deleteSquadListForm[squad.id] %}
                                                    {{ form_widget(deleteSquadForm.createView) }}
                                                    <button class="acButton" type="submit">
                                                        <i class="icon-remove"></i>
                                                    </button>
                                                </form>
                                            </div>
                                        </aside>
                                    </div>
                            {% endfor %}

                            <div>
                                <a
                                    href="{{
                                        path('squad_new',
                                        {'armySlug' : army.slug, 'unitTypeSlug' : tmp.unitType.slug, 'breedSlug' : tmp.unitType.breed.slug})
                                    }}"
                                    class="acButton"
                                >
                                    <i class="icon-plus"></i>
                                    {{ 'army.detail.squad.add'|trans }}
                                </a>
                            </div>
                        </section>
                    </div>
                </section>
            {% endfor %}
        </div>
    {% endblock %}
</section>
{% endblock %}

